<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>layim - WebIM</title>
        <link rel="stylesheet" href="css/contextMenu.css" />
        <link rel="stylesheet" href="layui/css/layui.css">
        <link rel="stylesheet" href="css/menu.css">
    </head>
    <body>

        <script type='text/javascript' src='js/biginteger.js'></script>
        <script type='text/javascript' src='js/snowflake.js'></script>
        <script type='text/javascript' src='js/protobuf.js'></script>
        <script type='text/javascript' src='js/socket.js'></script>
        <script src="layui/layui.js"></script>
        <script>
            let user = JSON.parse(localStorage.getItem("user"));
            let ackMsg = {};
            layui.use(['layim', 'jquery'], function () {
                let layim = layui.layim;
                let $ = layui.jquery;
                import {sendWSPush } from '/js/socket'
                layim.on('sendMessage', function(res){
                    sendWSPush(res);
                });

                //监听ws数据响应
                const getDataFunc = function(data) {
                    layim.getMessage({
                        username: "纸飞机" //消息来源用户名
                        ,avatar: "http://tp1.sinaimg.cn/1571889140/180/40030060651/1" //消息来源用户头像
                        ,id: "100000" //消息的来源ID（如果是私聊，则是用户id，如果是群聊，则是群组id）
                        ,type: "friend" //聊天窗口来源类型，从发送消息传递的to里面获取
                        ,content: "嗨，你好！本消息系离线消息。" //消息内容
                        ,cid: 0 //消息id，可不传。除非你要对消息进行一些操作（如撤回）
                        ,mine: false //是否我发送的消息，如果为true，则会显示在右方
                        ,fromid: "100000" //消息的发送者id（比如群组中的某个消息发送者），可用于自动解决浏览器多窗口时的一些问题
                        ,timestamp: 1467475443306 //服务端时间戳毫秒数。注意：如果你返回的是标准的 unix 时间戳，记得要 *1000
                    });
                };
                window.addEventListener('onmessageWS', getDataFunc)

                // //根据需要，销毁事件监听
                // window.removeEventListener('onmessageWS', getDataFunc)
                layim.config({
                    init: {
                        url: ''
                    },
                    //获取群成员
                    members: {
                        url: '', data: {}
                    }
                    //上传图片接口
                    , uploadImage: {
                        url: '' //（返回的数据格式见下文）
                        , type: 'post' //默认post
                    }
                    //上传文件接口
                    , uploadFile: {
                        url: '' //
                        , type: 'post' //默认post
                    }
                    //自定义皮肤
                    ,uploadSkin: {
                        url: ''
                        , type: 'post' //默认post
                    }           
                    //选择系统皮肤         
                    ,systemSkin: {
                        url: ''
                        , type: 'post' //默认post
                    }
                    //获取推荐好友
                    ,getRecommend:{
                        url: ''
                        , type: 'get' //默认
                    }
                    //查找好友总数
                    ,findFriendTotal:{
                        url: ''
                        , type: 'get' //默认
                    }                      
                    //查找好友
                    ,findFriend:{
                        url: ''
                        , type: 'get' //默认
                    }  
                    //获取好友资料
                    ,getInformation:{
                        url: ''
                        , type: 'get' //默认
                    }  
                    //保存我的资料
                    ,saveMyInformation:{
                        url: ''
                        , type: 'post' //默认
                    }                     
                    //提交建群信息
                    ,commitGroupInfo:{
                        url: ''
                        , type: 'get' //默认
                    }                                       
                    //获取系统消息
                    ,getMsgBox:{
                        url: ''
                        , type: 'get' //默认post
                    }                      
                    //获取总的记录数
                    ,getChatLogTotal:{
                        url: ''
                        , type: 'get' //默认post
                    }                       
                    //获取历史记录
                    ,getChatLog:{
                        url: ''
                        , type: 'get' //默认post
                    }                                     
                    , isAudio: false //开启聊天工具栏音频
                    , isVideo: false //开启聊天工具栏视频
                    , groupMembers: true
                    ,title: 'layim' 
                    ,copyright:true
                    , initSkin: '1.jpg' //1-5 设置初始背景
                    , notice: true //是否开启桌面消息提醒，默认false
                    , systemNotice: false //是否开启系统消息提醒，默认false
                    , msgbox: layui.cache.dir + 'css/modules/layim/html/msgbox.html' //消息盒子页面地址，若不开启，剔除该项即可
                    , find: layui.cache.dir + 'css/modules/layim/html/find.html' //发现页面地址，若不开启，剔除该项即可
                    , chatLog: layui.cache.dir + 'css/modules/layim/html/chatlog.html' //聊天记录页面地址，若不开启，剔除该项即可
                    , createGroup: layui.cache.dir + 'css/modules/layim/html/createGroup.html' //创建群页面地址，若不开启，剔除该项即可
                    , Information: layui.cache.dir + 'css/modules/layim/html/getInformation.html' //好友群资料页面
                });

            });

        </script>
    </body>
</html>
